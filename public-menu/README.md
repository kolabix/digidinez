# Public Menu - Simplified PWA System

This project automatically displays restaurant menus with PWA icons that are generated by the backend API when logos are uploaded.

## Features

- **Automatic PWA Icons**: Generated by backend API during logo upload
- **Vercel Blob Storage**: Icons are stored in Vercel Blob for global CDN distribution
- **Per-Restaurant Manifests**: Custom web app manifests for each restaurant
- **SSG Pre-rendering**: Static HTML generation for each restaurant menu
- **Fast Builds**: No icon generation during build process

## How It Works

1. **Logo Upload**: Restaurant owner uploads logo via admin panel
2. **Icon Generation**: Backend API automatically generates PWA icons
3. **Blob Storage**: Icons are uploaded to Vercel Blob storage
4. **Menu Build**: Public menu is built with existing icons
5. **Deployment**: Deploy button triggers Vercel build for menu updates

## Build Process

The build process is now simplified:

1. **Vite Build** (`npm run build`): Builds the React application
2. **SSG Pre-rendering** (`npm run build:ssg`): Generates static HTML for each restaurant

## Environment Variables

Create a `.env` file in the project root with:

```bash
VITE_API_URL=http://localhost:3001
SSG_BUILD_SECRET=your_secret_here
```

### Required Variables

- `VITE_API_URL`: Base URL of the DigiDinez API
- `SSG_BUILD_SECRET`: Secret key for authenticating with the API during build

## Generated Assets

### Icons

Icons are automatically generated by the backend API when logos are uploaded:

- `favicon-16x16.png` - 16x16 favicon
- `favicon-32x32.png` - 32x32 favicon  
- `apple-touch-icon.png` - 180x180 Apple touch icon
- `android-chrome-192x192.png` - 192x192 PWA icon
- `android-chrome-512x512.png` - 512x512 PWA icon
- `favicon.ico` - Traditional favicon

**Storage Location**: `restaurants/{restaurant_id}/icons/{filename}` in Vercel Blob

### Manifests

Each restaurant gets a custom web app manifest:

**File**: `dist/assets/manifest-{restaurant_id}.webmanifest`
**URL**: `/assets/manifest-{restaurant_id}.webmanifest`

## API Requirements

The system requires these API endpoints:

### 1. Restaurant List (SSG)
```
GET {APIURL}/restaurants/ssg/list
Headers: x-ssg-secret: {secret}
Response: { success: true, data: { restaurants: [{ id, name, logoUrl, brandColor }] } }
```

### 2. Restaurant Profile (Public)
```
GET {APIURL}/menu/public/{restaurantId}
Response: { success: true, data: { restaurant: { id, name, logoUrl, brandColor, ... } } }
```

## Deployment

### Vercel

The project is configured for Vercel deployment:

- **Build Command**: `npm run build:prod`
- **Output Directory**: `dist`
- **Headers**: Caching rules for manifests and HTML files

### Manual Deployment

```bash
# Install dependencies
npm install

# Build and generate HTML
npm run build:prod

# Deploy dist/ directory
```

## Benefits of New Architecture

- **Faster Builds**: No icon generation during build process
- **Immediate Icons**: Icons are ready as soon as logo is uploaded
- **Simpler Pipeline**: Build â†’ SSG only, no complex icon logic
- **Better UX**: Restaurant owners see icons update immediately
- **Cleaner Code**: Separation of concerns between API and frontend

## Troubleshooting

### Common Issues

1. **Missing Environment Variables**
   - Ensure all required `.env` variables are set
   - Check VITE_API_URL is accessible from build environment

2. **Icons Not Showing**
   - Verify logo was uploaded via admin panel
   - Check if icons exist in Vercel Blob storage
   - Ensure restaurant has logoUrl set

3. **Build Failures**
   - Verify SSG_BUILD_SECRET is correct
   - Check API connectivity during build

## Development

### Local Development

```bash
# Install dependencies
npm install

# Start development server
npm run dev

# Build for production
npm run build:prod
```

## License

This project is part of DigiDinez and follows the same licensing terms.
